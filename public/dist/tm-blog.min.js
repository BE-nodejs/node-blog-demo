/*! tm-blog 21-02-2015 */
function login(){function a(a){return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+escape(a).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}simpleValidate()&&$.post("",$("form").serialize()).done(function(){window.location=a("next")||"/home"}).fail(function(a){warn(msgMap[a.responseText]||"未知错误")})}function resetPassword(){var a=$("#password").val(),b=$("#password1").val();return""===a?(warn("密码不能为空"),!1):a!==b?(warn("两次输入的密码不一致"),!1):!0}function signup(){if(simpleValidate()){var a=$("[name=password]").val(),b=$("#password1").val();return a!=b?void warn("两次输入的密码不一致"):void $.post("",$("form").serialize()).done(info).fail(function(a){warn(a.responseText)})}}function simpleValidate(){var a=$("[name=username]").val().trim(),b=$("[name=password]").val();return 0===a.length?(warn("邮件不能为空"),!1):validateEmail(a)?0===b.length?(warn("密码不能为空"),!1):!0:(warn("邮件不合法"),!1)}function warn(a){$(".alert").hide(),$(".alert-danger").html(a).show()}function info(a){$(".alert").hide(),$(".alert-success").html(a).show()}function validateEmail(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function save(){return""===$("#title").val().trim()?$(".alert-danger").html("标题不能为空").show():void $("form").submit()}function comment(){var a=$("#new-comment").val();return""===a.trim()?$(".alert").html("评论不能为空").show():($("#new-comment").val(""),void $.post("",{content:a}).done(function(a){var b=$('<div class="comment"></div>').append($("<h5></h5>").html(a.author)).append($("<p></p>").html(a.content));$("#comments").append(b),$(".alert").hide()}).fail(function(a){return $(".alert").html("评论失败："+a).show()}))}function delPost(a){$.ajax({url:"/admin/post/"+a,type:"DELETE",success:function(){location.reload()}})}var msgMap={Unauthorized:"用户名或密码不正确",Unactived:"该用户尚未激活"};$(function(){0!==$("body#edit").length&&($("#content").bind("input propertychange",function(){$("#preview").html(marked($("#content").val()))}),$("#content").trigger("input"))}),marked.setOptions({highlight:function(a){return hljs.highlightAuto(a).value}}),$(function(){0!==$("body#post").length&&$(".post-content").each(function(a,b){var c=$(b);c.html(marked(c.find("#content").html()))})});